position = position_dodge(width = 0.7),
vjust = -.8) + # on the top
scale_fill_manual(values = c(Proportion = "#1696d2",  # change fill color
Race_prop = "#e88e2d"),
labels = c("In prosection",
"In population")) +
theme(
axis.line.y = element_blank(), #no axis lines and ticks
axis.ticks = element_blank(),
panel.grid.major.y = element_line(linetype="dotted", # add grid lines
color = "grey",
size =0.8),
legend.position = "top", # place legend on the bottom
legend.justification = "left",
legend.title = element_blank(),
text = element_text(family = "serif"), # format texts
plot.title = element_text(size = 15,
face="bold",
hjust= 0),
plot.caption = element_text(size = 11,
face = "italic",
hjust=0)
)
# Making the grouped bar chart
prosecution_pop %>%
select(Race, Proportion, Race_prop) %>%
pivot_longer(2:3, # long format makes both proportions a variable
names_to = "Prop_Type",
values_to = "Proportion") %>%
ggplot(aes(x = factor(Race,  # level according to perc being prosecuted
levels = c("White", "Black", "Latinx")),
y = Proportion,
fill = Prop_Type)) +
geom_col(position = "dodge") +
theme_classic() +
labs(x = "",
y = "",
title = "Fig 2: Proportions of People being Prosecuted\n And in Population by Race ",
caption = "Note: Other racial groups are excluded from the\n comparison due to small numbers\nSource: Data collected by the Vera Institute of Justice")+
scale_y_continuous(labels = scales::percent, # percent scale
expand = c(0,0),
limits =c(0,.7),
breaks = seq(0,.6,.2)) +
geom_text(aes(label =Proportion*1e2,
color = Prop_Type),
position = position_dodge(width = 0.7),
vjust = -.8) + # on the top
scale_fill_manual(values = c(Proportion = "#1696d2",  # change fill color
Race_prop = "#e88e2d"),
labels = c("In prosection",
"In population")) +
scale_color_manual(values = c(Proportion = "#1696d2",  # change fill color
Race_prop = "#e88e2d")) +
theme(
axis.line.y = element_blank(), #no axis lines and ticks
axis.ticks = element_blank(),
panel.grid.major.y = element_line(linetype="dotted", # add grid lines
color = "grey",
size =0.8),
legend.position = "top", # place legend on the bottom
legend.justification = "left",
legend.title = element_blank(),
text = element_text(family = "serif"), # format texts
plot.title = element_text(size = 15,
face="bold",
hjust= 0),
plot.caption = element_text(size = 11,
face = "italic",
hjust=0)
)
# Making the grouped bar chart
prosecution_pop %>%
select(Race, Proportion, Race_prop) %>%
pivot_longer(2:3, # long format makes both proportions a variable
names_to = "Prop_Type",
values_to = "Proportion") %>%
ggplot(aes(x = factor(Race,  # level according to perc being prosecuted
levels = c("White", "Black", "Latinx")),
y = Proportion,
fill = Prop_Type)) +
geom_col(position = "dodge") +
theme_classic() +
labs(x = "",
y = "",
title = "Fig 2: Proportions of People being Prosecuted\n And in Population by Race ",
caption = "Note: Other racial groups are excluded from the\n comparison due to small numbers\nSource: Data collected by the Vera Institute of Justice")+
scale_y_continuous(labels = scales::percent, # percent scale
expand = c(0,0),
limits =c(0,.7),
breaks = seq(0,.6,.2)) +
geom_text(aes(label =Proportion*1e2,
color = Prop_Type),
position = position_dodge(width = 0.7),
vjust = -.8) + # on the top
scale_fill_manual(values = c(Proportion = "#1696d2",  # change fill color
Race_prop = "#e88e2d"),
labels = c("In prosection",
"In population")) +
scale_color_manual(values = c(Proportion = "#1696d2",  # change fill color
Race_prop = "#e88e2d"),
labels = c("In prosection",
"In population")) +
theme(
axis.line.y = element_blank(), #no axis lines and ticks
axis.ticks = element_blank(),
panel.grid.major.y = element_line(linetype="dotted", # add grid lines
color = "grey",
size =0.8),
legend.position = "top", # place legend on the bottom
legend.justification = "left",
legend.title = element_blank(),
text = element_text(family = "serif"), # format texts
plot.title = element_text(size = 15,
face="bold",
hjust= 0),
plot.caption = element_text(size = 11,
face = "italic",
hjust=0)
)
gender_pop %>%
select(Race, Gender, Percent, Race_prop) %>%
pivot_longer(c(Percent, Race_prop),
names_to = "Prop_Type",
values_to = "Proportion") %>%
filter(Gender == "Female") %>%
mutate(Race = factor(Race,
levels = c("White",
"Latinx",
"Black"))) %>%
ggplot(aes(x = Prop_Type,
y = Proportion,
group = Race,
fill = Race)) +
geom_col(position = "stack",
width = .7) +
theme_classic() +
coord_flip() +
scale_x_discrete(labels = c("In population",
"In prosecution")) +
scale_y_continuous(labels = scales::percent, # percent scale
expand = c(0,0),
limits =c(0,1.1),
breaks = seq(0,1,.2)) +
scale_fill_manual(values = c("White"="#408941",
"Latinx" = "#9d9d9d",
"Black"="#e88e2d"),
breaks = c("Black", "Latinx", "White")) +
labs(title = "Fig 9: Among Females, Proportions of People Being\n Prosecuted And in Population by Race",
caption = "Note: Other racial groups are excluded from the\n comparison due to small numbers\nSource: Data collected by the Vera Institute of Justice",
x = "",
y = "") +
theme(
legend.title = element_blank(),
legend.position = "top",
legend.justification = "left",
axis.line = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_text(face="bold", size=10), # make group name visible
panel.grid.major.x = element_line(linetype="solid", # add grid line
color = "grey",
size =0.8),
text = element_text(family = "serif"), # format texts
plot.title = element_text(size = 15,
face="bold",
hjust= 0),
plot.caption = element_text(size = 11,
face = "italic",
hjust=0),
strip.background = element_rect(fill = "grey",  # facet label background
color = "white"),
strip.text.x = element_text(hjust=0.5,# center facet label text
face = "bold",
size = 12))
# loading libraries
library(readxl) # read Excel files
library(tidyverse)
library(waffle) # waffle plot
severity_pop %>%
select(Race, Severity, Percent, Race_prop) %>%
filter(Severity == "Felonies") %>%
pivot_longer(3:4, # long format makes both proportions a variable
names_to = "Prop_Type",
values_to = "Proportion") %>%
ggplot(aes(x = factor(Race,  # level according to perc being prosecuted
levels = c("Latinx", "Black", "White")),
y = Proportion)) +
geom_line(aes(group = Race), size = 1.4, alpha =.8) +
geom_point(aes(color = Prop_Type), size = 3, alpha =.8)  +
geom_text(aes(color = Prop_Type,
label = paste0(round(Proportion*100), "%")),
size = 3,
vjust = 2,
nudge_x = -.1) +
coord_flip() +
theme_classic() +
labs(x = "",
y = "",
title = "Fig 5: Among Felonies, Proportions of People Being Prosecuted\n And in Population by Race",
caption = "Note: Other racial groups are excluded from the\n comparison due to small numbers\nSource: Data collected by the Vera Institute of Justice")+
scale_y_continuous(labels = scales::percent, # percent scale
expand = c(0,0),
limits =c(0,.7),
breaks = seq(0,.6,.2)) +
scale_color_manual(values = c(Percent = "#1696d2",  # change fill color
Race_prop = "#e88e2d"),
labels = c("In prosection", "In population")) +
theme(
axis.line.y = element_blank(), #no axis lines and ticks
axis.ticks = element_blank(),
panel.grid.major.y = element_line(linetype="solid", # add grid lines
color = "grey",
size =1),
legend.position = "top", # place legend on the bottom
legend.justification = "left",
legend.title = element_blank(),
legend.box.margin = margin(b = 0, t =0),
text = element_text(family = "serif"), # format texts
plot.title = element_text(size = 15,
face="bold",
hjust= 0),
plot.caption = element_text(size = 11,
face = "italic",
hjust=0))
11.7/4.7
13.7/3.9
# loading libraries
library(readxl) # read Excel files
library(tidyverse)
library(waffle) # waffle plot
# loading data
path <- "data/" # define relative path
cases_data <- read_xlsx(paste0(path, "TestCases.xlsx"))
person_data <- read_xlsx(paste0(path, "TestPerson.xlsx"))
cases_person <- person_data %>%  # join two data together
left_join(cases_data,
by = "CaseNum")
# data cleaning
cases_person <- cases_person %>%
filter(!row_number() %in% which(is.na(Race))) %>% # remove NAs
mutate(Race = recode(Race,  # recoding
"W"="White",
"B" = "Black",
"A"="Asian",
"H"="Latinx",
"U"="Unknown",
"ME"="Middle Eastern"))
# population data
race_population <- data.frame(Race = c("White", "Black", "Latinx"),
Population = c(98000, 41000, 46000))
# Creating aggregated table
prosecution_pop <-
cases_person %>%
group_by(Race) %>%
summarise(Count = n()) %>% # aggregate table
filter(Race %in% c("White",
"Black",
"Latinx")) %>%
mutate(Proportion = round( # % among all being prosecuted
Count/sum(Count),
4)) %>%
left_join(race_population,
by = "Race") %>%
mutate(Race_prop = round( # % almong all populations
Population/sum(Population),
4)) %>%
mutate(Rate_per_1k = round(Count/Population*1e3, #per 1k in each racial group
1))
# Recoding and NA removal
cases_person <- cases_person %>%
filter(!row_number() %in% which(is.na(Severity))) %>% # remove NAs
mutate(Severity = recode(Severity,  # recoding
"F"="Felonies",
"M" = "Misdemeanors"))
case_person %>%
filter(Severity == "Misdemeanors") %>%
count() %>%
arrange(-n)
cases_person %>%
filter(Severity == "Misdemeanors") %>%
count() %>%
arrange(-n)
cases_person %>%
filter(Severity == "Misdemeanors") %>%
count(Charge) %>%
arrange(-n)
cases_person %>%
filter(Severity == "Felonies") %>%
count(Charge) %>%
arrange(-n)
cases_person %>%
filter(Severity == "Misdemeanors") %>%
count(Charge) %>%
arrange(-n)
cases_person %>%
distinct(Charge)
# Make the pie chart
cases_person %>%
filter(Race %in% c("White",
"Black",
"Latinx")) %>%
group_by(Severity) %>%
summarise(count = n()) %>%
ggplot(aes(x="", y=count, fill=Severity))+
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0) +  # makes the bar chart a pie
scale_fill_manual(values = c("#12719e", "#73bfe2")) +
theme_minimal()+
labs(title = "Fig 3: Number of Prosecuted People by Crime Severity",
caption = "Source: Data collected by the Vera Institute of Justice") +
theme(      # formatting
legend.title = element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x=element_blank(),
text = element_text(family = "serif"),
plot.title=element_text(size=15,
hjust = 0,
face="bold"),
plot.caption = element_text(size = 11,
hjust=0,
face = "italic"))
11.7/4.7
11.7/3.4
# aggreagted table
gender_pop <-
cases_person %>%
filter(Race %in% c("White",
"Black",
"Latinx")) %>% # drop others
group_by(Race, Gender) %>%
summarise(Count=n()) %>%
group_by(Gender) %>%
summarise(Percent = round( # % among all being prosecuted
Count/sum(Count),4),
Race = Race,
Count = Count
) %>%
left_join(race_population,
by = "Race") %>%
mutate(Race_prop = round( # % almong all populations
Population/sum(Population),
4)) %>%
mutate(Rate_per_1k = round(Count/Population*1e3, #per 1k in each racial group
1))
gender_pop %>%
select(Race, Gender, Percent, Race_prop) %>%
pivot_longer(c(Percent, Race_prop),
names_to = "Prop_Type",
values_to = "Proportion") %>%
filter(Gender == "Male") %>%
mutate(Race = factor(Race,
levels = c("White",
"Latinx",
"Black")))
gender_pop %>%
select(Race, Gender, Percent, Race_prop) %>%
pivot_longer(c(Percent, Race_prop),
names_to = "Prop_Type",
values_to = "Proportion") %>%
filter(Gender == "Male")
gender_pop
# recode gender
cases_person <-
cases_person %>%
mutate(Gender = recode(Gender,
"F" = "Female",
"M" = "Male"
))
# aggreagted table
gender_pop <-
cases_person %>%
filter(Race %in% c("White",
"Black",
"Latinx")) %>% # drop others
group_by(Race, Gender) %>%
summarise(Count=n()) %>%
group_by(Gender) %>%
summarise(Percent = round( # % among all being prosecuted
Count/sum(Count),4),
Race = Race,
Count = Count
) %>%
left_join(race_population,
by = "Race") %>%
mutate(Race_prop = round( # % almong all populations
Population/sum(Population),
4)) %>%
mutate(Rate_per_1k = round(Count/Population*1e3, #per 1k in each racial group
1))
gender_pop %>%
select(Race, Gender, Percent, Race_prop) %>%
pivot_longer(c(Percent, Race_prop),
names_to = "Prop_Type",
values_to = "Proportion") %>%
filter(Gender == "Male") %>%
mutate(Race = factor(Race,
levels = c("White",
"Latinx",
"Black")))
# Create horizontal stacked bar chart that compares prosecuted males by race
gender_pop %>%
select(Race, Gender, Percent, Race_prop) %>%
pivot_longer(c(Percent, Race_prop),
names_to = "Prop_Type",
values_to = "Proportion") %>%
filter(Gender == "Male") %>%
mutate(Race = factor(Race,
levels = c("White",
"Latinx",
"Black"))) %>%
ggplot(aes(x = Prop_Type,
y = Proportion,
group = Race,
fill = Race)) +
geom_col(position = "stack",
width = .7) +
theme_classic() +
coord_flip() +  #flip coordinates
scale_x_discrete(labels = c("In prosecution",
"In population")) +
scale_y_continuous(labels = scales::percent, # percent scale
expand = c(0,0),
limits =c(0,1.1),
breaks = seq(0,1,.2)) +
scale_fill_manual(values = c("White"="#408941",
"Latinx" = "#9d9d9d",
"Black"="#e88e2d"),
breaks = c("Black", "Latinx", "White")) +
labs(title = "Fig 9: Among Males, Proportions of People Being\n Prosecuted And in Population by Race",
caption = "Note: Other racial groups are excluded from the\n comparison due to small numbers\nSource: Data collected by the Vera Institute of Justice",
x = "",
y = "") +
theme(
legend.title = element_blank(),
legend.position = "top",
legend.justification = "left",
axis.line = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_text(face="bold", size=10), # make group name visible
panel.grid.major.x = element_line(linetype="solid", # add grid line
color = "grey",
size =0.8),
text = element_text(family = "serif"), # format texts
plot.title = element_text(size = 15,
face="bold",
hjust= 0),
plot.caption = element_text(size = 11,
face = "italic",
hjust=0),
strip.background = element_rect(fill = "grey",  # facet label background
color = "white"),
strip.text.x = element_text(hjust=0.5,# center facet label text
face = "bold",
size = 12))
# Create horizontal stacked bar chart that compares prosecuted females by race
gender_pop %>%
select(Race, Gender, Percent, Race_prop) %>%
pivot_longer(c(Percent, Race_prop),
names_to = "Prop_Type",
values_to = "Proportion") %>%
filter(Gender == "Female") %>%
mutate(Race = factor(Race,
levels = c("White",
"Latinx",
"Black"))) %>%
ggplot(aes(x = Prop_Type,
y = Proportion,
group = Race,
fill = Race)) +
geom_col(position = "stack",
width = .7) +
theme_classic() +
coord_flip() +
scale_x_discrete(labels = c("In prosecution",   # reformat tick label
"In population")) +
scale_y_continuous(labels = scales::percent, # percent scale
expand = c(0,0),
limits =c(0,1.1),
breaks = seq(0,1,.2)) +
scale_fill_manual(values = c("White"="#408941",
"Latinx" = "#9d9d9d",
"Black"="#e88e2d"),
breaks = c("Black", "Latinx", "White")) +
labs(title = "Fig 10: Among Females, Proportions of People Being\n Prosecuted And in Population by Race",
caption = "Note: Other racial groups are excluded from the\n comparison due to small numbers\nSource: Data collected by the Vera Institute of Justice",
x = "",
y = "") +
theme(
legend.title = element_blank(),
legend.position = "top",
legend.justification = "left",
axis.line = element_blank(),
axis.ticks.x = element_blank(),
axis.text.y = element_text(face="bold", size=10), # make group name visible
panel.grid.major.x = element_line(linetype="solid", # add grid line
color = "grey",
size =0.8),
text = element_text(family = "serif"), # format texts
plot.title = element_text(size = 15,
face="bold",
hjust= 0),
plot.caption = element_text(size = 11,
face = "italic",
hjust=0),
strip.background = element_rect(fill = "grey",  # facet label background
color = "white"),
strip.text.x = element_text(hjust=0.5,# center facet label text
face = "bold",
size = 12))
View(dc21_arrests_weapon)
